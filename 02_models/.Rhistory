E_sea_b_NB = states[7, 2, ],
I_sea_b_NB = states[7, 3, ],
R_sea_b_NB = states[7, 4, ],
D_sea_b_NB = states[7, 5, ],
S_b_NB = states[8, 1, ],
E_b_NB = states[8, 2, ],
I_b_NB = states[8, 3, ],
R_b_NB = states[8, 4, ],
D_b_NB = states[8, 5, ],
S_a_N = states[9, 1, ],
E_a_N = states[9, 2, ],
I_a_N = states[9, 3, ],
R_a_N = states[9, 4, ],
D_a_N = states[9, 5, ],
S_b_N = states[10, 1, ],
E_b_N = states[10, 2, ],
I_b_N = states[10, 3, ],
R_b_N = states[10, 4, ],
D_b_N = states[10, 5, ]) %>%
mutate(
S_a_total = S_a + S_sea_a,
E_a_total = E_a + E_sea_a,
I_a_total = I_a + I_sea_a,
R_a_total = R_a + R_sea_a,
D_a_total = D_a + D_sea_a,
S_b_total = S_b + S_sea_b,
E_b_total = E_b + E_sea_b,
I_b_total = I_b + I_sea_b,
R_b_total = R_b + R_sea_b,
D_b_total = D_b + D_sea_b,
S_a_NB_total = S_a_NB + S_sea_a_NB,
E_a_NB_total = E_a_NB + E_sea_a_NB,
I_a_NB_total = I_a_NB + I_sea_a_NB,
R_a_NB_total = R_a_NB + R_sea_a_NB,
D_a_NB_total = D_a_NB + D_sea_a_NB,
S_b_NB_total = S_b_NB + S_sea_b_NB,
E_b_NB_total = E_b_NB + E_sea_b_NB,
I_b_NB_total = I_b_NB + I_sea_b_NB,
R_b_NB_total = R_b_NB + R_sea_b_NB,
D_b_NB_total = D_b_NB + D_sea_b_NB
)
return(output)
}
# Run simulation
time1 <- Sys.time()
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
time2 <- Sys.time()
time2 - time1
# Plot results
output_long = melt(output[1:nrow(output)-1, ], id = "time")
output_a = output_long %>% filter(variable %in% c("S_a_total", "E_a_total", "I_a_total", "R_a_total", "D_a_total"))
plot_a = ggplot(output_a, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_N = output_long %>% filter(variable %in% c("S_a_N", "E_a_N", "I_a_N", "R_a_N", "D_a_N"))
plot_a_N = ggplot(output_a_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in A")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_NB = output_long %>% filter(variable %in% c("S_a_NB_total", "E_a_NB_total", "I_a_NB_total", "R_a_NB_total", "D_a_NB_total"))
plot_a_NB = ggplot(output_a_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b = output_long %>% filter(variable %in% c("S_b_total", "E_b_total", "I_b_total", "R_b_total", "D_b_total"))
plot_b = ggplot(output_b, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_N = output_long %>% filter(variable %in% c("S_b_N", "E_b_N", "I_b_N", "R_b_N", "D_b_N"))
plot_b_N = ggplot(output_b_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in B")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_NB = output_long %>% filter(variable %in% c("S_b_NB_total", "E_b_NB_total", "I_b_NB_total", "R_b_NB_total", "D_b_NB_total"))
plot_b_NB = ggplot(output_b_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
plot_grid(plot_a, plot_a_N, plot_a_NB,
plot_b, plot_b_N, plot_b_NB,
labels = c("A", "B", "C",
"D", "E", "F"),
label_size = 12)
#
# summary_output = function(output){
#
#   N_a = output[1, c("S_a", "I_a")] %>% sum()
#
#   max_infected_a = max(output[, "I_a"])
#   prop_max_infected_a = max_infected_a / N_a
#   dead_a = output[nrow(output), "D_a"]
#   prop_dead_a = dead_a / N_a
#
#   max_infected_sea = max(output[, "I_sea"])
#   dead_sea = output[nrow(output), "D_sea"]
#
#   prop_non_exposed_from_a = (output[nrow(output), "S_a"] + output[nrow(output), "S_sea"] - output[1, "S_sea"] ) / N_a
#
#   return( data.frame(
#     N_a = N_a,
#     max_infected_a = max_infected_a,
#     prop_max_infected_a = prop_max_infected_a,
#     dead_a = dead_a,
#     prop_dead_a = prop_dead_a,
#     max_infected_sea = max_infected_sea,
#     dead_sea = dead_sea,
#     prop_non_exposed_from_a = prop_non_exposed_from_a
#
#   ))
# }
#
#
# output_long_list = data.frame()
# response_list = data.frame()
#
# nb_iterations = 8
#
# for (i in 1:nb_iterations){
#
#   output = gillespie_seir(epi_param, initial_state, total_time)
#   output_long = melt(output, id = "time")
#
#   output_long_i = cbind(output_long,
#                          data.frame(simulation = rep(i, times = nrow(output_long))))
#
#   output_long_list = rbind(output_long_list, output_long_i)
#   response_list = rbind(response_list, summary_output(output))
#
# }
#
#
# output_a = output_long_list %>% filter(variable %in% c("S_a", "E_a", "I_a", "R_a", "D_a"))
#
# p = ggplot()
# for(i in 1:nb_iterations){
#   p = p + geom_line(data = output_a %>% subset(., simulation == i )
#                     , aes(x = time, y = value, color = variable))
# }
# p = p +
#   labs(x = "Time", y = "Number of individuals", color = "Compartment") +
#   theme_minimal() +
#   ggtitle("Stochastic SEIR Model Simulation (Gillespie Algorithm)")
#
#
# p
#
#
# data_long = pivot_longer(response_list, cols = -N_a, names_to = "variable", values_to = "value")
#
# # CrÃ©er les diagrammes en violon pour chaque variable
# ggplot(data_long %>% subset(., variable %in% c("dead_a", "max_infected_a")),
#        aes(x = variable, y = value)) +
#   geom_violin() +
#   geom_dotplot(binaxis='y', stackdir='center', dotsize=1)
#
#
plot_seir = function(output = output){
output_long = melt(output[1:nrow(output)-1, ], id = "time")
output_a = output_long %>% filter(variable %in% c("S_a_total", "E_a_total", "I_a_total", "R_a_total", "D_a_total"))
plot_a = ggplot(output_a, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_N = output_long %>% filter(variable %in% c("S_a_N", "E_a_N", "I_a_N", "R_a_N", "D_a_N"))
plot_a_N = ggplot(output_a_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in A")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_NB = output_long %>% filter(variable %in% c("S_a_NB_total", "E_a_NB_total", "I_a_NB_total", "R_a_NB_total", "D_a_NB_total"))
plot_a_NB = ggplot(output_a_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b = output_long %>% filter(variable %in% c("S_b_total", "E_b_total", "I_b_total", "R_b_total", "D_b_total"))
plot_b = ggplot(output_b, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_N = output_long %>% filter(variable %in% c("S_b_N", "E_b_N", "I_b_N", "R_b_N", "D_b_N"))
plot_b_N = ggplot(output_b_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in B")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_NB = output_long %>% filter(variable %in% c("S_b_NB_total", "E_b_NB_total", "I_b_NB_total", "R_b_NB_total", "D_b_NB_total"))
plot_b_NB = ggplot(output_b_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
plot_grid_seir = plot_grid(plot_a, plot_a_N, plot_a_NB,
plot_b, plot_b_N, plot_b_NB,
labels = c("A", "B", "C",
"D", "E", "F"),
label_size = 12)
print(plot_grid_seir)
}
plot_seir()
plot_seir()
plot_seir = function(output_ = output){
output_long = melt(output_[1:nrow(output_)-1, ], id = "time")
output_a = output_long %>% filter(variable %in% c("S_a_total", "E_a_total", "I_a_total", "R_a_total", "D_a_total"))
plot_a = ggplot(output_a, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_N = output_long %>% filter(variable %in% c("S_a_N", "E_a_N", "I_a_N", "R_a_N", "D_a_N"))
plot_a_N = ggplot(output_a_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in A")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_a_NB = output_long %>% filter(variable %in% c("S_a_NB_total", "E_a_NB_total", "I_a_NB_total", "R_a_NB_total", "D_a_NB_total"))
plot_a_NB = ggplot(output_a_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in A (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b = output_long %>% filter(variable %in% c("S_b_total", "E_b_total", "I_b_total", "R_b_total", "D_b_total"))
plot_b = ggplot(output_b, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_N = output_long %>% filter(variable %in% c("S_b_N", "E_b_N", "I_b_N", "R_b_N", "D_b_N"))
plot_b_N = ggplot(output_b_N, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Nestlings in B")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
output_b_NB = output_long %>% filter(variable %in% c("S_b_NB_total", "E_b_NB_total", "I_b_NB_total", "R_b_NB_total", "D_b_NB_total"))
plot_b_NB = ggplot(output_b_NB, aes(x = time, y = value, color = variable)) +
geom_line() +
labs(x = "Time", y = "Number of individuals", color = "Status") +
theme_minimal() +
ggtitle("Non-Breeders in B (colony+Sea)")+
scale_color_brewer(palette="Set2", labels = c("S", "E", "I", "R", "D"))
plot_grid_seir = plot_grid(plot_a, plot_a_N, plot_a_NB,
plot_b, plot_b_N, plot_b_NB,
labels = c("A", "B", "C",
"D", "E", "F"),
label_size = 12)
print(plot_grid_seir)
}
plot_seir()
time1 <- Sys.time()
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
time2 <- Sys.time()
time2 - time1
plot_seir()
summary_output = function(output){
N_a = output[1, c("S_a", "I_a")] %>% sum()
max_infected_a = max(output[, "I_a"])
prop_max_infected_a = max_infected_a / N_a
dead_a = output[nrow(output), "D_a"]
prop_dead_a = dead_a / N_a
max_infected_sea = max(output[, "I_sea"])
dead_sea = output[nrow(output), "D_sea"]
prop_non_exposed_from_a = (output[nrow(output), "S_a"] + output[nrow(output), "S_sea"] - output[1, "S_sea"] ) / N_a
return( data.frame(
N_a = N_a,
max_infected_a = max_infected_a,
prop_max_infected_a = prop_max_infected_a,
dead_a = dead_a,
prop_dead_a = prop_dead_a,
max_infected_sea = max_infected_sea,
dead_sea = dead_sea,
prop_non_exposed_from_a = prop_non_exposed_from_a
))
}
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
response_list = rbind(response_list, summary_output(output))
}
i = 1
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
response_list = rbind(response_list, summary_output(output))
output_long_list
summary_output(output)
output
N_a = output[1, c("S_a", "I_a")] %>% sum()
max_infected_a = max(output[, "I_a"])
prop_max_infected_a = max_infected_a / N_a
dead_a = output[nrow(output), "D_a"]
prop_dead_a = dead_a / N_a
max_infected_sea = max(output[, "I_sea"])
summary_output = function(output){
N_a = output[1, c("S_a", "I_a")] %>% sum()
max_infected_a = max(output[, "I_a"])
prop_max_infected_a = max_infected_a / N_a
dead_a = output[nrow(output), "D_a"]
prop_dead_a = dead_a / N_a
max_infected_sea = max(output[, "I_sea_a"])
dead_sea = output[nrow(output), "D_sea_a"]
prop_non_exposed_from_a = (output[nrow(output), "S_a"] + output[nrow(output), "S_sea"] - output[1, "S_sea"] ) / N_a
return( data.frame(
N_a = N_a,
max_infected_a = max_infected_a,
prop_max_infected_a = prop_max_infected_a,
dead_a = dead_a,
prop_dead_a = prop_dead_a,
max_infected_sea = max_infected_sea,
dead_sea = dead_sea,
prop_non_exposed_from_a = prop_non_exposed_from_a
))
}
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
response_list = rbind(response_list, summary_output(output))
}
p = ggplot()
output_long_list
output_a = output_long_list %>% filter(variable %in% c("S_a", "E_a", "I_a", "R_a", "D_a"))
p = ggplot()
for(i in 1:nb_iterations){
p = p + geom_line(data = output_a %>% subset(., simulation == i )
, aes(x = time, y = value, color = variable))
}
p = p +
labs(x = "Time", y = "Number of individuals", color = "Compartment") +
theme_minimal() +
ggtitle("Stochastic SEIR Model Simulation (Gillespie Algorithm)")
p
data_long = pivot_longer(response_list, cols = -N_a, names_to = "variable", values_to = "value")
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
response_list = rbind(response_list, summary_output(output))
}
output
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
response_list = rbind(response_list, summary_output(output))
}
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
#response_list = rbind(response_list, summary_output(output))
}
output_a = output_long_list %>% filter(variable %in% c("S_a", "E_a", "I_a", "R_a", "D_a"))
output_a = output_long_list %>% filter(variable %in% c("S_a", "E_a", "I_a", "R_a", "D_a"))
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
#response_list = rbind(response_list, summary_output(output))
}
output_long_list = data.frame()
response_list = data.frame()
nb_iterations = 8
for (i in 1:nb_iterations){
output = gillespie_seir(param = param,
induced_dispersal = T,
initial_number_breeders_A = 50,
initial_number_infected_breeders_A = 1,
initial_number_breeders_B = 50,
total_time = 70,
dispersal_stochactic = T,
tau = 0.2)
output_long = melt(output, id = "time")
output_long_i = cbind(output_long,
data.frame(simulation = rep(i, times = nrow(output_long))))
output_long_list = rbind(output_long_list, output_long_i)
#response_list = rbind(response_list, summary_output(output))
}
output_a = output_long_list %>% filter(variable %in% c("S_a", "E_a", "I_a", "R_a", "D_a"))
p = ggplot()
for(i in 1:nb_iterations){
p = p + geom_line(data = output_a %>% subset(., simulation == i )
, aes(x = time, y = value, color = variable))
}
p = p +
labs(x = "Time", y = "Number of individuals", color = "Compartment") +
theme_minimal() +
ggtitle("Stochastic SEIR Model Simulation (Gillespie Algorithm)")
p
